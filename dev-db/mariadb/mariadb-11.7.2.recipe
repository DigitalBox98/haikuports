SUMMARY="Maria DB is an open-source relational database management system (RDBMS)"
DESCRIPTION="MariaDB server is a community developed fork of MySQL server. \
Started by core members of the original MySQL team, MariaDB actively works \
with outside developers to deliver the most featureful, stable, and sanely \
licensed open SQL server in the industry."
HOMEPAGE="https://www.mariadb.org/"
COPYRIGHT="2009 - 2025 MariaDB Foundation"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/MariaDB/server/archive/refs/tags/mariadb-11.7.2.tar.gz"
CHECKSUM_SHA256="63abb60682d7c62f0195e8aa85301775af11ef0b7e700775dd8f232068fbe448"
SOURCE_DIR="server-mariadb-$portVersion"
SOURCE_URI_2="https://github.com/mariadb-corporation/mariadb-connector-c/archive/refs/tags/v3.4.4.tar.gz"
CHECKSUM_SHA256_2="79a1c5a3de86e7daa0a456c502d60dc15debe105932ad6a0d25024908603f433"
SOURCE_URI_3="https://github.com/codership/wsrep-lib/archive/70cd967f5e249b53d6cce90e2e4198641c564381.tar.gz"
CHECKSUM_SHA256_3="bd44ee719f8fb303e8f90aaab105db836edc44cd8bb73004f20810248a0e6758"
SOURCE_URI_4="https://github.com/codership/wsrep-API/archive/refs/heads/master.tar.gz"
CHECKSUM_SHA256_4="ed0866ee46043b0e6f23cab0a7bcf11441add76ab9091e9e10c658ff0789841c"
# TODO : remaining modules to include
#SOURCE_URI_5="https://github.com/facebook/rocksdb/archive/bba5e7bc21093d7cfa765e1280a7c4fdcd284288.tar.gz"
#CHECKSUM_SHA256_5="xxx"
#SOURCE_URI_6="https://github.com/wolfSSL/wolfssl/archive/239b85c80438bf60d9a5b9e0ebe9ff097a760d0d.tar.gz"
#CHECKSUM_SHA256_6="yyy"
#SOURCE_URI_7="https://github.com/mariadb-corporation/libmarias3/archive/0d5babbe46f17147ed51efd1f05a0001017a2aad.tar.gz"
#CHECKSUM_SHA256_7="zzz"
#SOURCE_URI_8="https://https://github.com/mariadb-corporation/mariadb-columnstore-engine/archive/9763b126517c8efb716e767fd5ba4eb2b5b405fc.tar.gz"
#CHECKSUM_SHA256_8="aaa"
PATCHES="mariadb-11.7.2.patchset"

ARCHITECTURES="?all !x86_gcc2 x86_64"
SECONDARY_ARCHITECTURES="!x86"

PROVIDES="
	mariadb = $portVersion
	cmd:mariadb$secondaryArchSuffix
	lib:libmariadb$secondaryArchSuffix
	"
REQUIRES="
	haiku
	lib:libncurses$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libncurses$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix
	devel:libz
	"
BUILD_PREREQUIRES="
	cmd:g++
	cmd:bison
	cmd:ninja
	cmd:cmake
	cmd:make
	cmd:which
	"

BUILD()
{
	cp -r $sourceDir2/mariadb-connector-c-3.4.4/* $sourceDir/libmariadb/
	cp -r $sourceDir3/wsrep-lib-70cd967f5e249b53d6cce90e2e4198641c564381/* $sourceDir/wsrep-lib
	cp -r $sourceDir4/wsrep-API-master/* $sourceDir/wsrep-lib/wsrep-API/v26

	# TOCHECK : even if Release is indicated, mariadbd binary is with debug info ?
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=Release \
		-DWITHOUT_AIO=ON \
		-DPLUGIN_TOKUDB=NO \
		-DWITH_SYSTEMD=no \
		-DPLUGIN_CONNECT=NO \
		-DWITH_SSL=system \
		-DWITHOUT_ROCKSDB=ON \
		-DCMAKE_EXE_LINKER_FLAGS="-lnetwork" \
		-DCMAKE_SHARED_LINKER_FLAGS="-lnetwork"

	cmake --build build $jobArgs
}


INSTALL()
{
	# TODO : check best place to install binaries and libs instead of $appsDir/MariaDB
	cmake --install build --prefix $appsDir/MariaDB
}

