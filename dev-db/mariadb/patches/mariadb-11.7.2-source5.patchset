From 8016b1f55b4bf0e622e2fa1f713be20981685570 Mon Sep 17 00:00:00 2001
From: DigitalBox98 <digitalbox098@gmail.com>
Date: Fri, 21 Feb 2025 00:01:03 +0000
Subject: Fix fs_posix.cc


diff --git a/rocksdb-bba5e7bc21093d7cfa765e1280a7c4fdcd284288/env/fs_posix.cc b/rocksdb-bba5e7bc21093d7cfa765e1280a7c4fdcd284288/env/fs_posix.cc
index 0f1a41a..45b7879 100644
--- a/rocksdb-bba5e7bc21093d7cfa765e1280a7c4fdcd284288/env/fs_posix.cc
+++ b/rocksdb-bba5e7bc21093d7cfa765e1280a7c4fdcd284288/env/fs_posix.cc
@@ -13,6 +13,12 @@
 #include <errno.h>
 #include <fcntl.h>
 
+#ifdef __HAIKU__
+#include <sys/stat.h>
+#define major(dev) (((dev) >> 8) & 0xFF)
+#define minor(dev) ((dev) & 0xFF)
+#endif
+
 #if defined(OS_LINUX)
 #include <linux/fs.h>
 #endif
-- 
2.45.2


From 424f2ed3cf94e5bde1c732c7234d8499578de115 Mon Sep 17 00:00:00 2001
From: DigitalBox98 <digitalbox098@gmail.com>
Date: Fri, 21 Feb 2025 00:14:16 +0000
Subject: Fix io_posix.cc


diff --git a/rocksdb-bba5e7bc21093d7cfa765e1280a7c4fdcd284288/env/io_posix.cc b/rocksdb-bba5e7bc21093d7cfa765e1280a7c4fdcd284288/env/io_posix.cc
index a2bbab3..6d04cbf 100644
--- a/rocksdb-bba5e7bc21093d7cfa765e1280a7c4fdcd284288/env/io_posix.cc
+++ b/rocksdb-bba5e7bc21093d7cfa765e1280a7c4fdcd284288/env/io_posix.cc
@@ -914,7 +914,11 @@ IOStatus PosixMmapFile::Flush(const IOOptions& /*opts*/,
 
 IOStatus PosixMmapFile::Sync(const IOOptions& /*opts*/,
                              IODebugContext* /*dbg*/) {
+#ifdef __HAIKU__
+  if (fsync(fd_) < 0) {
+#else
   if (fdatasync(fd_) < 0) {
+#endif   
     return IOError("While fdatasync mmapped file", filename_, errno);
   }
 
@@ -1123,7 +1127,11 @@ IOStatus PosixWritableFile::Flush(const IOOptions& /*opts*/,
 
 IOStatus PosixWritableFile::Sync(const IOOptions& /*opts*/,
                                  IODebugContext* /*dbg*/) {
+#ifdef __HAIKU__
+  if (fsync(fd_) < 0) {
+#else
   if (fdatasync(fd_) < 0) {
+#endif   
     return IOError("While fdatasync", filename_, errno);
   }
   return IOStatus::OK();
@@ -1305,7 +1313,11 @@ IOStatus PosixRandomRWFile::Flush(const IOOptions& /*opts*/,
 
 IOStatus PosixRandomRWFile::Sync(const IOOptions& /*opts*/,
                                  IODebugContext* /*dbg*/) {
+#ifdef __HAIKU__
+  if (fsync(fd_) < 0) {
+#else
   if (fdatasync(fd_) < 0) {
+#endif   
     return IOError("While fdatasync random read/write file", filename_, errno);
   }
   return IOStatus::OK();
-- 
2.45.2

